define(["backbone","jquery","underscore","renderer","util"],function(Backbone,$,_,Renderer,Util){return function(){window.logger=function(){function e(e){!n||!a&&r&&r.log||n.apply(i,e)}function t(e){return d>0?d>e:c.length+d<=e}for(var n,a,i=this,o=Array.prototype.slice,r=i.console,s={},d=9,c=["error","warn","info","debug","log"],l="assert clear count dir dirxml exception group groupCollapsed groupEnd profile profileEnd table time timeEnd trace".split(" "),u=l.length,p=[];--u>=0;)!function(e){s[e]=function(){0!==d&&r&&r[e]&&r[e].apply(r,arguments)}}(l[u]);for(u=c.length;--u>=0;)!function(n,a){s[a]=function(){var s=o.call(arguments),d=[a].concat(s);p.push(d),e(d),r&&t(n)&&(r.firebug?r[a].apply(i,s):r[a]?r[a](s):r.log(s))}}(u,c[u]);return s.setLevel=function(e){d="number"==typeof e?e:9},s.setCallback=function(){var t=o.call(arguments),i=p.length,r=i;for(n=t.shift()||null,a="boolean"==typeof t[0]?t.shift():!1,r-="number"==typeof t[0]?t.shift():i;i>r;)e(p[r++])},s}(),window.logger.debug=function(){},Array.prototype.remove=function(){for(var e,t,n=arguments,a=n.length;a&&this.length;)for(e=n[--a];-1!==(t=this.indexOf(e));)this.splice(t,1);return this},String.prototype.trunc=String.prototype.trunc||function(e){return this.length>e?this.substr(0,e-1)+"&hellip;":this},Backbone.timeout=18e4,"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t}),Backbone.cancelableRequests=[],Backbone.views=[],Util.mixin(Backbone.View.prototype,Renderer),"localStorage"in window&&null!==window.localStorage&&(Backbone.store=window.localStorage),"undefined"==typeof console&&(console={log:function(){}}),Backbone.session={},Backbone.preloaderCounter=0;var oldConstructor=Backbone.View;Backbone.View=function(e){this.config=e.config,delete e.config,this.allWidgetsLoaded=!1,this.eventStack=[],this.store=Backbone.store,void 0==e.rows&&(e.rows=1),void 0==e.columns&&(e.columns=1),oldConstructor.call(this,e),void 0==e.append&&(e.append=!1),this.renderTemplate(void 0===this.template?{template:"template",append:e.append}:this.template===!1?{template:"__empty__",append:e.append}:{template:this.template,append:e.append}),this.$el.attr("cid",this.cid),Backbone.views.push(this)},Util.mixin(Backbone.View,oldConstructor),Backbone.View.prototype=oldConstructor.prototype,Backbone.moveView=function(e,t){var n=_.findWhere(Backbone.views,{cid:e});"undefined"!=typeof n&&"undefined"!=typeof t&&(t.append($(n.$el.children()[0]).remove()),Util.removeCidFromContainer(e,n.$el),Util.appendCidToContainer(e,$(t)),n.setElement(t),n.options.el=t)},Backbone.killView=function(e){var t=_.filter(Backbone.views,{cid:e})[0];Backbone.views=_.reject(Backbone.views,{cid:e}),t.destroy()},Backbone.EventBus=_.extend({},Backbone.Events),Backbone.widget=function(view,dependancies){void 0==dependancies&&(dependancies=[]);for(var i=2;i<arguments.length,void 0!=arguments[i];i++)$.ajax({async:!1,dataType:"text",url:arguments[i],success:function(data){var lastIndexOf=data.lastIndexOf("}"),father=eval("("+data.substring(data.indexOf("{"),lastIndexOf+1)+")");view=Util.mixinRecursive(father,view);var deps=data.substring(lastIndexOf),depStart=deps.indexOf("[");depStart>-1&&(dependancies=_.union(dependancies,_.map(deps.substring(depStart+1,deps.lastIndexOf("]")).split(","),function(e){return e.trim().split("'").join("")})))},error:function(e){console.log("Error in ajax is : "+e),alert("COULD NOT LOAD PARENT TO INHERIT FROM !!!(Check console for ajax error)")}});return dependancies=_.map(dependancies,function(e){return Util.trim(e)}),define(dependancies,function(){return view.deps=arguments,Backbone.View.extend(view)})},Backbone.bwidget=function(e,t){return void 0==t&&(t=[]),t.push("bootstrap"),this.widget(e,t)},Backbone.loadedTemplates={},Backbone.loadedTemplates.__empty__="",Backbone.loadTemplate=function(e,t,n){void 0==n&&(n=this),void 0==Backbone.loadedTemplates[e]?$.ajax({url:e,method:"GET",success:function(a){Backbone.loadedTemplates[e]=a,t.call(n,a)},error:function(){-1==e.indexOf("template.html")?alert("cannot load template from url "+e):t.call(n,"")}}):t.call(n,Backbone.loadedTemplates[e])},_.templateSettings={evaluate:/\{=(.+?)\=}/gm,interpolate:/\{\{(.+?)\}\}/g,escape:/\{-(.+?)\}/g},_.mixin({contains:function(e,t){var n=_.keys(t),a=!1;return a=_.any(n,function(n){var a=e[n],i=t[n];if(_.isObject(i)){var o=_.contains(a,i);return!o}return a!=i}),!a},mergeObjects:function(e,t,n){for(n in t)t.hasOwnProperty(n)&&("o"==(typeof e[n])[0]?m(e[n],t[n]):e[n]=t[n])},findDeep:function(e,t){function n(e){if(void 0!=e){for(var n in t)if(t[n]!==e[n])return!1;return!0}return!1}function a(e){var t;return _.forEach(e,function(e){return n(e)?(t=e,!1):((_.isObject(e)||_.isArray(e))&&(t=a(e)),t?!1:void 0)}),t}return a(e)}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){return _.indexOf(this,e)}),$.fn.isFrom=function(e){return $(this).is(e)||$(this).parents(e).size()>0?!0:!1},$.fn.cssInt=function(e){return parseInt(this.css(e),10)||0},$.fn.cssFloat=function(e){return parseFloat(this.css(e))||0},$("body").on("click",".editable",function(){var e=$(this).attr("id");void 0==e&&(e=Util.guid(),$(this).attr("id",e),$(this).attr("contenteditable","true")),CKEDITOR.instances[e]||CKEDITOR.inline(e);for(name in CKEDITOR.instances)name!==e&&CKEDITOR.instances[name].destroy(!1)});var dateFormat=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,a=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e};return function(i,o,r){var s=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(i)||/\d/.test(i)||(o=i,i=void 0),i=i?new Date(i):new Date,isNaN(i))throw SyntaxError("invalid date");o=String(s.masks[o]||o||s.masks["default"]),"UTC:"==o.slice(0,4)&&(o=o.slice(4),r=!0);var d=r?"getUTC":"get",c=i[d+"Date"](),l=i[d+"Day"](),u=i[d+"Month"](),p=i[d+"FullYear"](),m=i[d+"Hours"](),f=i[d+"Minutes"](),y=i[d+"Seconds"](),h=i[d+"Milliseconds"](),g=r?0:i.getTimezoneOffset(),b={d:c,dd:a(c),ddd:s.i18n.dayNames[l],dddd:s.i18n.dayNames[l+7],m:u+1,mm:a(u+1),mmm:s.i18n.monthNames[u],mmmm:s.i18n.monthNames[u+12],yy:String(p).slice(2),yyyy:p,h:m%12||12,hh:a(m%12||12),H:m,HH:a(m),M:f,MM:a(f),s:y,ss:a(y),l:a(h,3),L:a(h>99?Math.round(h/10):h),t:12>m?"a":"p",tt:12>m?"am":"pm",T:12>m?"A":"P",TT:12>m?"AM":"PM",Z:r?"UTC":(String(i).match(t)||[""]).pop().replace(n,""),o:(g>0?"-":"+")+a(100*Math.floor(Math.abs(g)/60)+Math.abs(g)%60,4),S:["th","st","nd","rd"][c%10>3?0:(c%100-c%10!=10)*c%10]};return o.replace(e,function(e){return e in b?b[e]:e.slice(1,e.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(e,t){return dateFormat(this,e,t)}}});