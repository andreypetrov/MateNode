define(["jquery","backbone","underscore","construct","util"],function(t,e,n,o,a){var r=e.Router.extend({initialize:function(n){this.options=n;var a=t("meta[name=widgetConfig]").attr("value"),r=this;"undefined"!=typeof a?t.ajax({type:"GET",dataType:"json",url:a,async:!1,success:function(t){e.constructor=r.constructor=new o(t)},error:function(){e.constructor=r.constructor=new o}}):e.constructor=r.constructor=new o,e.history.start()},routes:{"":"handleRoute",":page":"handleRoute",":page/:parameters":"handleRoute"},handleRoute:function(t,n){this.cancelRequests(),this.cleanGarbage(),0==this.options.layout&&(t=!1),void 0===t&&(t=this.options.homeLayout),e.currentLayout=t,void 0!==n?this.parseParameters(n):e.request={},this.changeLayout(t)},parseParameters:function(o){e.request={};var a=o.split("&");n.each(a,function(n){var o=n.split("="),a='{"'+o[0]+'":"'+o[1]+'"}';t.extend(e.request,jQuery.parseJSON(a))})},cancelRequests:function(){n.forEach(e.cancelableRequests,function(t){t.abort()}),e.cancelableRequests=[]},cleanGarbage:function(){var t=n.filter(e.views,function(t){return void 0!==t.options.clean&&"false"===t.options.clean?!1:!0});n.each(t,function(t){t.destroy()}),e.views=n.filter(e.views,function(t){return void 0!==t.options.clean&&"false"===t.options.clean?!0:!1})},changeLayout:function(t){var n=this.constructor;t?require(["text!"+this.options.layoutsPath+t+".html"],function(t){document.getElementById("layouts").innerHTML=a.trim(t),e.totalWidgets=0,n.createWidgets("body")}):(e.totalWidgets=0,n.createWidgets("body"))}});return r});